#!/bin/bash

set -e -x

WORKDIR=$PWD

TAG=v$(cat garden-linux-release-tarball/version)

# switch release repo to tag determined by tarball version
pushd garden-linux-release-master
  git fetch --tags
  git checkout $TAG
  git submodule update --init --recursive
popd

# copy switched repo somewhere so we can nuke its parent dir
cp -a garden-linux-release-master /tmp/garden-linux-repo

# tuck and roll
cd /

# replace workdir with switched repo
rm -rf $WORKDIR
cp -a /tmp/garden-linux-repo $WORKDIR
rm -rf /tmp/garden-linux-repo
